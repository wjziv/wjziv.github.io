<!DOCTYPE html>
<html>
<head>
<!-- Basics -->
<title>Walter Zielenski</title>
<meta name=viewport content="width=device-width, initial-scale=1">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-155539992-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-155539992-1');
</script>

<!-- CSS || Chota CSS || https://jenil.github.io/chota/ -->
<script src="https://kit.fontawesome.com/54b4256db9.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.rawgit.com/kimeiga/bahunya/css/bahunya-0.1.3.css"/>

<!-- https://prismjs.com/ Code Text Formatting -->
<script src="/static/js/prism.js"></script>

<!-- JQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<!-- Custom Files -->
<script src="/static/js/script.js"></script>
<link rel="stylesheet" href="/static/css/style.css">

<!-- HTML Meta Tags -->
<meta name="description" content="Backend Developer">
<meta name="keywords" content="Backend, Programming, Developer, Python, SQL, GCP, Google Cloud Platform, Baking, Super Cool Dude">
<meta name="author" content="Walter Zielenski">

<!-- Google / Search Engine Tags -->
<meta itemprop="name" content="Walter Zielenski">
<meta itemprop="description" content="Backend Developer">
<meta itemprop="image" content="/static/img/wjziv.png">

<!-- Facebook Meta Tags -->
<meta property="og:url" content="">
<meta property="og:type" content="website">
<meta property="og:title" content="Walter Zielenski">
<meta property="og:description" content="Backend Developer">
<meta property="og:image" content="/static/img/wjziv.png">

<!-- Twitter Meta Tags -->
<meta name="twitter:card" content="/static/img/wjziv.png">
<meta name="twitter:title" content="Walter Zielenski">
<meta name="twitter:description" content="Backend Developer">
<meta name="twitter:image" content="/static/img/wjziv.png">

<!-- Add to homescreen for Chrome on Android -->
<meta name="mobile-web-app-capable" content="yes">
<link rel="icon" sizes="192x192" href="/static/img/wjziv.png">

<!-- Add to homescreen for Safari on iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Walter Zielenski">
<link rel="apple-touch-icon-precomposed" href="/static/img/wjziv.png">
</head>
<body><header>
  <nav>
    <a href="/">
      <h1>
        <img src="/static/img/wjziv.png" style="display:inline-block;vertical-align:middle;max-height:32px;" class="logo"/>
        &nbsp; Walter Zielenski
      </h1>
    </a>

    <input type="checkbox" id="menu-toggle">
    <label for="menu-toggle" style="font-size:larger;">&#9776;</label>
    
    <a href="/blog/">
      blog
    </a>
    
    <a href="/projects/">
      projects
    </a>
    
    <a href="/recipes/">
      recipes
    </a>
    
  </nav>
  <h1>
    VSCode on the Cloud
  </h1>
  
  <h6>
    2020-04-26
  </h6>

  
  <p>
  
  <kbd>How-to</kbd>
  
  <kbd>VSCode</kbd>
  
  <kbd>IDE</kbd>
  
  <kbd>Cloud</kbd>
  
  
  </p>
  

</header>
  <main>
    <article>
    
<h1>Goal</h1>
<p>Using Google Cloud Platform, host an instance of VSCode to access via the browser for ~$25-$50/month.
More specifically, we'll be hosting an instance of <a href="https://github.com/cdr/code-server">Code-Server</a> on GCP in a constantly-running VM.</p>
<p>This works as an alternative to the cloud-development environments which may limit the developer in some way:
- Number of private repositories
- Working Hours in a given period
- Number of projects
- Repository integration.</p>
<h1>Requirements</h1>
<p>This tutorial assumes you have already set up a GCP account and enabled billing.</p>
<h1>Short Description:</h1>
<ul>
<li>Make GCP VM</li>
<li>Install Code-Server.</li>
<li>Set up SSL Certificate via Certbot.</li>
<li>Write start-up script, scheduled by Crontab.</li>
<li>Associate with a subomain.</li>
</ul>
<h1>Steps</h1>
<ol>
<li>GCP &gt; GCE &gt; Create VM</li>
<li>Design your instance.
    My preference is for E2 (2 Cores, 4GB RAM) running Debian 10 Buster, 10GB storage. This set-up costs ~$25/month at the time of writing.
    E2 cores are not entirely reserved, hence the cheaper price. In my case, this is a personal development machine. This said, I have not experienced any signs of poorer performance. Run an N1/N2 machine to reserve your cores at a higher cost (~$50/month).</li>
<li>Enable HTTP/HTTPS access.</li>
<li>Create Instance.</li>
<li>Once VM instance is done being built, press the SSH button.</li>
<li>Copy and paste: <code>sudo apt update &amp;&amp; sudo apt upgrade &amp;&amp; sudo apt -y install wget curl certbot screen</code>. This will make sure your VM is up to date and has the dependncies installed which we'll be needing shortly.</li>
<li>
<p>Use the following bash commands to download the lastest release of VSCode for the browser (hosted on coder/code-server) and extract it to your VM's home directory. Feel free to copy/paste the whole script:
    <code>bash
    curl -s https://api.github.com/repos/cdr/code-server/releases/latest | grep "browser_download_url" | grep "linux-x86_64" | cut -d '"' -f4 | wget -qi - -O code-server.tar.gz &amp;&amp; mkdir code-server &amp;&amp; tar -xzf code-server.tar.gz -C code-server --strip-components 1 &amp;&amp; rm code-server.tar.gz</code></p>
<p>Let's pick it apart, piece by piece:
- <code>curl -s https://api.github.com/repos/cdr/code-server/releases/latest</code>: Make a request for the url provided without providing any output. (The URL provided is the permalink to the latest releases made for the project hosting the software we're isntalling on our VM.)
- <code>grep "browser_download_url"</code>: given the response from above, seek out lines which contain the given string.
- <code>grep "linux-x86_64"</code>: given the response from above, seek out lines which contain the given string.
- <code>cut -d '"' -f4</code>: split the response from above, using <code>"</code> as a delimiter. Return the 4th field after splitting.
- <code>wget -qi - -O code-server.tar.gz</code>: given the response from above, make a request for the url and rename it. Do this without providing output.
- <code>mkdir code-server</code>: make a new folder called "code-server"
- <code>tar -xzf code-server.tar.gz -C code-server --strip-components 1</code>: extract the contents of the last file we downloaded into the folder we just made.
- <code>rm code-server.tar.gz</code>: delete the compressed file since we've extracted its contents.</p>
<p>For extra notes on the connectors between each command, see this <a href="https://unix.stackexchange.com/questions/159489/is-there-a-difference-between-and-and">Stack Overflow</a> Q/A.
9. (Optional) If you'd like to access the server via HTTPS (and if you're planning on accessing this VM through a URL, you'd most likely be in this pool) install and execute certbot:
<code>sudo certbot certonly --standalone</code>
<a href="https://certbot.eff.org/">Certbot</a> is a tool provided by the EFF to make handling SSL certificates fast and easy.  They'll take your email address to contact you should there be an emergency regarding access to your machine, but beyond this, consider them your cosigner to prove legitimacy.
Take note of where the SSL certificate and key are saved. We'll need them later.
10. Create a script to execute code-server. Using your favorite code editor, create a file called <code>run-code-server.sh</code> and start editing:
```bash</p>
<h1>!/bin/bash</h1>
<p>while true
do</p>
<p>sudo PASSWORD=yOur_Pa55w0rd \
        ./code-server/code-server \
                --auth password \
                --port 443 \
                --cert "/etc/your/path/to/cert/fullchain.pem" \
                --cert-key "/etc/your/path/to/certkey/privkey.pem"
sleep 3
done
<code>Note the following:
- Code-Server allows the user to set up a password for accessing their coding environment. Provide a custom one by declaring the `PASSWORD` variable on the same line.
- `--port 443`: this is the default port which HTTPS requests use. IF you plan on using a clean URL to access your VM and have no intentions to set up a reverse proxy of some kind, this is necessary. Otherwise, feel free to set it to something else, and navigate to it via `yourwebsite.com:PORT` or `12.34.56.78:PORT`. Take note of your selection, as it will be needed later.
- `--cert "/etc/path..."`: if you have an SSL certificate to provide, enter the path here.
- `--cert-key "/etc/path..."`: if you have an SSL certificate to provide, enter the path here.
11. Start Crontab to schedule your script to execute upon start-up: `crontab -e`
If this is your first time opening crontab, it will ask you to select a preferred editor, which can be changed at any time.
Once inside your crontab file, add the following line:</code>bash
@reboot screen -m -d sh $HOME/run-code-server.sh
<code>``
Save and exit.
12. Close the SSH terminal.
13. GCP &gt; VPC Network &gt; Firewall Rules &gt; Create a new Firewall Rule
14. Name it whatever you like Set a priority ~ 1000. Add your port to the TCP port section. Should you be running applications on extra ports on this VM, it may be worthwhile to add a few others: 8080, 8888, 8443, or whatever is preferred to you.
15. GCP &gt; VPC Network &gt; External IP Addresses
16. Find your VM you created and under the</code>Type` column, change the value from "Ephemeral" to "Static". This will keep your external IP address constant, and ease access to it. Take note of this IP address for later.
17. Restart your VM.
18. (Optional) Make your VM accessible through the web via a custom domain which you may already have by performing the following:
- Navigate to your domain admin dashboard
- Add a new Custom resource record
- Type: A
- Name: the subdomain you'd prefer to use for your development VM (if any).
- Data/IP Address: the static IP address of your VM.
Save your settings and wait. It may take a few minutes/hours for your domain to be set up.</p>
</li>
</ol>
<p>This should be all it takes to get your own, custom cloud-hosted development environment up and running for about the price of any other unlimited cloud-dev env!</p>
<p>Navigate to your dev env using:
- Your external IP and port: <code>12.34.56.78:PORT</code>.
- Your custom domain and port (with cert): https://subdomain.yourdomain.com:PORT
- Your custom domain and port (without cert): http://subdomain.yourdomain.com:PORT
- Your custom domain, assuming port 443 (with cert): http://subdomain.yourdomain.com</p>
<h1>References and Resources</h1>
<p>Note that there are plenty of alternative softwares for a few of these services:</p>
<h2>Cloud Based IDEs</h2>
<p><a href="https://github.com/cdr/code-server">Code-Server</a>
<a href="https://github.com/cdr/sshcode">SSH-Code</a>
<a href="https://theia-ide.org/">Theia Ecplise</a></p>
<h2>Containerized Solutions</h2>
<p><a href="https://hub.docker.com/r/codercom/code-server">Code-Server</a>
<a href="https://hub.docker.com/r/linuxserver/code-server">Linux-Server</a></p>
<h2>Cloud Based Development as a Service</h2>
<p><a href="https://www.gitpod.io/">Gitpod</a>
<a href="https://stackblitz.com/">Stackblitz</a>
<a href="https://codesandbox.io/">CodeSandbox</a></p>
<h2>GCP Shell Options</h2>
<p><a href="https://cloud.google.com/shell">Google Cloud Shell</a></p>
<a href="/blog/">
  < Blog
</a>

    </article>
  </main><footer>
  
  
  <a class="footer-link" href="http://twitter.com/wjziv" target="_blank" style="text-decoration: none;">
    <img src="https://icongr.am/fontawesome/twitter.svg?size=32&amp;color=F5F5F5"/>
  </a>
  
  
  
  <a class="footer-link" href="http://github.com/wjziv" target="_blank" style="text-decoration: none;">
    <img src="https://icongr.am/fontawesome/github.svg?size=32&amp;color=F5F5F5"/>
  </a>
  
  
  
  <a class="footer-link" href="https://www.linkedin.com/in/walterjzielenskiiv/" target="_blank" style="text-decoration: none;">
    <img src="https://icongr.am/fontawesome/linkedin.svg?size=32&amp;color=F5F5F5"/>
  </a>
  
  
  
  <a class="footer-link" href="mailto:walterzielenski@gmail.com" target="_blank" style="text-decoration: none;">
    <img src="https://icongr.am/fontawesome/envelope.svg?size=32&amp;color=F5F5F5"/>
  </a>
  
  
  <p>
    CSS: <a href="https://kimeiga.github.io/bahunya/" target="_blank">Bahunya</a>
  </p>
</footer>
</body>
</html>